<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Login</title>
        <link
            rel="stylesheet"
            href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css"
        />
        <link rel="stylesheet" href="./css/authStyles.css" />
    </head>
    <body>
        <!-- Navigation bar -->
        <nav class="navbar navbar-expand-lg custom">
            <!-- Navigation content -->
            <!-- ... (Include the navigation bar content here) -->
        </nav>
        <div class="main">
            <div id="bg"></div>
            <div class="card">
                <div class="form-signup">
                    <h1>Welcome Back</h1>
                    <p class="invalid" id="errorMessage"></p>
                    <form id="loginForm">
                        <p class="invalid" id="emailErrorPara"></p>
                        <p class="invalid" id="passwordErrorPara"></p>
                        <input
                            placeholder="Email"
                            type="email"
                            name="email"
                            class="email"
                            id="input--email"
                        />
                        <input
                            placeholder="Password"
                            type="password"
                            name="password"
                            class="password"
                            id="input--password"
                        />
                        <button id="login--button" type="submit">Login</button>
                    </form>

                    <p class="">Don't have an account ?</p>
                    <a href="./patientSignup.html">Register</a>
                </div>
                <div class="image-container">
                    <img src="./images/LoginImage.svg" />
                </div>
            </div>
        </div>

        <!-- Include required JavaScript files -->
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
        <script src="/js/particles.min.js"></script>
        <script>
            document.addEventListener("DOMContentLoaded", function () {
                // Function to handle form submission with AJAX
                function handleSubmit(event) {
                    event.preventDefault(); // Prevent the default form submission

                    // Get form input values
                    const email = document.getElementById("input--email").value;
                    const password =
                        document.getElementById("input--password").value;

                    // Create a new XMLHttpRequest
                    const xhr = new XMLHttpRequest();
                    xhr.open(
                        "POST",
                        "http://localhost:5050/patients/login",
                        true
                    );

                    xhr.withCredentials = true;
                    
                    xhr.setRequestHeader("Content-Type", "application/json");

                    // Define the function to handle the response
                    xhr.onreadystatechange = function () {
                        if (xhr.readyState === 4) {
                            if (xhr.status === 200) {
                                const data = JSON.parse(xhr.responseText);
                                // Handle the response data

                                window.location.href = "./patientDashboard.html";
                            } else {
                                console.error("Error:", xhr.status);
                            }
                        }
                    };

                    const requestBody = JSON.stringify({ email, password });

                    xhr.send(requestBody);
                }

                const loginForm = document.getElementById("loginForm");
                loginForm.addEventListener("submit", handleSubmit);
            });
        </script>
    </body>
</html>
